<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sahar & Iftar Timings</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0F3738">
<link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/2290/2290073.png">

<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('./sw.js');
    });
  }
</script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap');

        :root {
            --bg-top: #0F3738;
            --bg-bottom: #FDF9F1;
            --gold: #D7AE5D;
            --text-dark: #0F3738;
            --text-light: #ffffff;
            --surface: #ffffff;
            --border: rgba(15, 55, 56, 0.1);
            --modal-border: #ddd;
            --body-bg: #e5e5e5;
            --font-main: 'Poppins', sans-serif;
        }

        /* Dark Theme Variables */
        [data-theme="dark"] {
            --bg-top: #0a2425; 
            --bg-bottom: #121212;
            --text-dark: #f0f0f0; 
            --text-light: #e0e0e0;
            --surface: #1e1e1e;
            --border: rgba(255, 255, 255, 0.1);
            --modal-border: #333;
            --body-bg: #000000;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: var(--font-main);
            background-color: var(--body-bg);
            display: flex;
            justify-content: center;
            /* Use 100dvh to perfectly fit modern mobile browser heights */
            height: 100vh; 
            height: 100dvh;
            overflow: hidden; /* Prevents body scrolling */
            transition: background-color 0.3s ease;
        }

        .app-container {
            width: 100%;
            max-width: 450px;
            height: 100%;
            background-color: var(--bg-bottom);
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            transition: background-color 0.3s ease;
        }

        /* TOP SECTION */
        .top-section {
            background-color: var(--bg-top);
            color: var(--text-light);
            text-align: center;
            padding: 3vh 20px 4vh; /* Responsive padding */
            position: relative;
            border-bottom: 4px solid var(--gold);
            transition: background-color 0.3s ease;
        }

        /* Theme Toggle Button */
        .theme-toggle-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: transparent;
            border: none;
            cursor: pointer;
            padding: 5px;
            display: flex;
            align-items: center;
            gap: 6px;
            color: var(--gold);
            font-family: var(--font-main);
            font-weight: 600;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .theme-toggle-btn svg {
            width: 20px;
            height: 20px;
            fill: var(--gold);
            transition: transform 0.3s ease;
        }
        .theme-toggle-btn:active svg {
            transform: scale(0.9);
        }

        .branding { font-size: 13px; letter-spacing: 2px; color: var(--gold); margin-bottom: 2vh; font-weight: 600; }
        .mosque-icon svg { width: 50px; height: auto; fill: var(--gold); margin-bottom: 2vh; }
        .date-display { font-size: clamp(20px, 6vw, 26px); font-weight: 700; margin-bottom: 5px; }
        .day-display { font-size: 15px; font-weight: 300; letter-spacing: 1px; color: #ccc; }

        /* BOTTOM SECTION */
        .bottom-section {
            padding: 2vh 20px;
            text-align: center;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: space-evenly; /* Evenly distributes space so it never overflows */
        }

        .title-text { color: var(--text-dark); font-weight: 700; font-size: clamp(16px, 5vw, 20px); transition: color 0.3s ease; }

        .city-wrapper { display: flex; flex-direction: column; align-items: center; }
        
        .city-selector {
            display: inline-flex; align-items: center; justify-content: center; gap: 8px;
            padding: 8px 20px; border: 1.5px solid var(--gold); border-radius: 30px;
            color: var(--text-dark); font-weight: 600; cursor: pointer; margin-bottom: 4px;
            background: transparent; font-size: 16px; transition: color 0.3s ease;
        }
        .city-selector svg { width: 16px; fill: var(--text-dark); transition: fill 0.3s ease; }
        
        .city-hint {
            font-size: 11px;
            color: var(--text-dark);
            opacity: 0.6;
            font-weight: 400;
            transition: color 0.3s ease;
        }

        .timings-wrapper { display: flex; justify-content: space-between; gap: 15px; }
        .timing-box {
            background: var(--surface); border: 1px solid var(--border);
            border-radius: 12px; padding: 2vh 10px; flex: 1; box-shadow: 0 4px 6px rgba(0,0,0,0.02);
            transition: background 0.3s ease, border 0.3s ease;
        }
        .timing-box h2 { font-size: 16px; color: var(--gold); margin-bottom: 8px; font-weight: 700; }
        .timing-box .time { font-size: clamp(16px, 5vw, 19px); color: var(--text-dark); font-weight: 700; transition: color 0.3s ease; }

        .countdown-box { background: var(--bg-top); color: white; border-radius: 12px; padding: 2.5vh 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); transition: background 0.3s ease;}
        .countdown-label { font-size: 13px; color: var(--gold); margin-bottom: 6px; font-weight: 600; text-transform: uppercase; }
        .countdown-timer { font-size: clamp(26px, 8vw, 32px); font-weight: 700; font-variant-numeric: tabular-nums; }

        .calendar-btn { background: transparent; color: var(--text-dark); border: none; text-decoration: underline; font-weight: 600; font-size: 14px; cursor: pointer; padding: 10px; font-family: inherit; transition: color 0.3s ease;}

        /* Modals */
        .modal-overlay {
            position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.7); display: none; justify-content: center; align-items: center;
            z-index: 100; padding: 20px;
        }
        .modal-content { background: var(--bg-bottom); width: 100%; max-height: 90%; border-radius: 16px; padding: 20px; overflow-y: auto; position: relative; transition: background 0.3s ease;}
        .close-btn { position: absolute; top: 15px; right: 15px; background: var(--bg-top); color: white; border: none; width: 30px; height: 30px; border-radius: 50%; font-weight: bold; cursor: pointer; z-index: 10; }

        .city-list { list-style: none; margin-top: 20px; }
        .city-list li { padding: 15px; border-bottom: 1px solid var(--modal-border); font-weight: 600; color: var(--text-dark); text-align: center; cursor: pointer; transition: color 0.3s ease, border 0.3s ease; }

        /* Responsive Table Adjustments */
        .table-responsive {
            width: 100%;
            overflow-x: auto;
            margin-top: 20px;
        }
        .calendar-table { 
            width: 100%; 
            border-collapse: collapse; 
            font-size: clamp(11px, 3.5vw, 14px); 
        }
        .calendar-table th, .calendar-table td { 
            border: 1px solid var(--modal-border); 
            padding: 8px 4px; 
            text-align: center; 
            color: var(--text-dark);
            white-space: nowrap; 
            transition: color 0.3s ease, border 0.3s ease;
        }
        .calendar-table th { background: var(--bg-top); color: white; }
        .active-day { background-color: rgba(215, 174, 93, 0.3); font-weight: bold; }
    </style>
</head>
<body>

<div class="app-container">
    <div class="top-section">
        <button class="theme-toggle-btn" onclick="toggleTheme()" aria-label="Toggle Dark/Light Mode">
            <span>Theme</span>
            <svg id="theme-icon" viewBox="0 0 24 24">
                <path d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9c0-.46-.04-.92-.1-1.36-.98 1.37-2.58 2.26-4.4 2.26-3.03 0-5.5-2.47-5.5-5.5 0-1.82.89-3.42 2.26-4.4-.44-.06-.9-.1-1.36-.1z"/>
            </svg>
        </button>

        <div class="branding">DAWAT-E-ISLAMI</div>
        <div class="mosque-icon">
            <svg viewBox="0 0 24 24"><path d="M12 2C10.89 2 10 2.89 10 4V4.5C8.82 5.06 8 6.42 8 8V12H4V14H6V22H18V14H20V12H16V8C16 6.42 15.18 5.06 14 4.5V4C14 2.89 13.11 2 12 2M12 4C12.55 4 13 4.45 13 5V5.5C13 5.5 13 6 12 6C11 6 11 5.5 11 5.5V5C11 4.45 11.45 4 12 4M12 7C14.21 7 16 8.79 16 11V12H8V11C8 8.79 9.79 7 12 7Z" /></svg>
        </div>
        <div class="date-display" id="date-display">-- / --</div>
        <div class="day-display" id="day-display">--</div>
    </div>

    <div class="bottom-section">
        <div class="title-text">SAHAR-O-IFTAR TIMING</div>
        
        <div class="city-wrapper">
            <button class="city-selector" onclick="openCityModal()">
                <svg viewBox="0 0 24 24"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>
                <span id="selected-city">KARACHI</span>
            </button>
            <span class="city-hint">Click on city name to change</span>
        </div>

        <div class="timings-wrapper">
            <div class="timing-box">
                <h2>SAHAR</h2>
                <div class="time" id="sahar-time">--:--:--</div>
            </div>
            <div class="timing-box">
                <h2>IFTAR</h2>
                <div class="time" id="iftar-time">--:--:--</div>
            </div>
        </div>

        <div class="countdown-box">
            <div class="countdown-label" id="countdown-label">Time left</div>
            <div class="countdown-timer" id="countdown-timer">00:00:00</div>
        </div>

        <button class="calendar-btn" onclick="openCalendarModal()">View Full Month Calendar</button>
    </div>

    <div class="modal-overlay" id="city-modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeModals()">✕</button>
            <h3 style="text-align:center; color: var(--text-dark); margin-top:10px;">Select City</h3>
            <ul class="city-list">
                <li onclick="changeCity('KARACHI')">KARACHI</li>
                <li onclick="changeCity('LAHORE')">LAHORE</li>
                <li onclick="changeCity('ISLAMABAD')">ISLAMABAD</li>
            </ul>
        </div>
    </div>

    <div class="modal-overlay" id="calendar-modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeModals()">✕</button>
            <h3 style="text-align:center; color: var(--text-dark); margin-top:10px;" id="cal-title">Ramadan Calendar</h3>
            <div class="table-responsive">
                <table class="calendar-table">
                    <thead><tr><th>Roza</th><th>Date</th><th>Sahar</th><th>Iftar</th></tr></thead>
                    <tbody id="calendar-body"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
    const DB = {
      'KARACHI': [
        ["1","19-02-2026","5:45:40 AM","6:30:22 PM"],["2","20-02-2026","5:44:57 AM","6:30:57 PM"],["3","21-02-2026","5:44:13 AM","6:31:32 PM"],["4","22-02-2026","5:43:28 AM","6:32:06 PM"],["5","23-02-2026","5:42:42 AM","6:32:39 PM"],["6","24-02-2026","5:41:55 AM","6:33:13 PM"],["7","25-02-2026","5:41:08 AM","6:33:45 PM"],["8","26-02-2026","5:40:19 AM","6:34:18 PM"],["9","27-02-2026","5:39:29 AM","6:34:50 PM"],["10","28-02-2026","5:38:38 AM","6:35:22 PM"],["11","01-03-2026","5:37:47 AM","6:35:53 PM"],["12","02-03-2026","5:36:54 AM","6:36:24 PM"],["13","03-03-2026","5:36:00 AM","6:36:55 PM"],["14","04-03-2026","5:35:05 AM","6:37:25 PM"],["15","05-03-2026","5:34:09 AM","6:37:55 PM"],["16","06-03-2026","5:33:12 AM","6:38:25 PM"],["17","07-03-2026","5:32:15 AM","6:38:55 PM"],["18","08-03-2026","5:31:16 AM","6:39:24 PM"],["19","09-03-2026","5:30:17 AM","6:39:54 PM"],["20","10-03-2026","5:29:16 AM","6:40:22 PM"],["21","11-03-2026","5:28:15 AM","6:40:51 PM"],["22","12-03-2026","5:27:13 AM","6:41:20 PM"],["23","13-03-2026","5:26:10 AM","6:41:48 PM"],["24","14-03-2026","5:25:06 AM","6:42:16 PM"],["25","15-03-2026","5:24:02 AM","6:42:44 PM"],["26","16-03-2026","5:22:56 AM","6:43:11 PM"],["27","17-03-2026","5:21:51 AM","6:43:38 PM"],["28","18-03-2026","5:20:44 AM","6:44:06 PM"],["29","19-03-2026","5:19:37 AM","6:44:33 PM"],["30","20-03-2026","5:18:29 AM","6:44:59 PM"]
      ],
      'LAHORE': [
        ["1","19-02-2026","5:18:31 AM","5:51:24 PM"],["2","20-02-2026","5:17:34 AM","5:52:13 PM"],["3","21-02-2026","5:16:36 AM","5:53:02 PM"],["4","22-02-2026","5:15:37 AM","5:53:51 PM"],["5","23-02-2026","5:14:38 AM","5:54:40 PM"],["6","24-02-2026","5:13:38 AM","5:55:28 PM"],["7","25-02-2026","5:12:37 AM","5:56:17 PM"],["8","26-02-2026","5:11:35 AM","5:57:05 PM"],["9","27-02-2026","5:10:33 AM","5:57:53 PM"],["10","28-02-2026","5:09:30 AM","5:58:41 PM"],["11","01-03-2026","5:08:26 AM","5:59:28 PM"],["12","02-03-2026","5:07:22 AM","6:00:16 PM"],["13","03-03-2026","5:06:17 AM","6:01:03 PM"],["14","04-03-2026","5:05:11 AM","6:01:50 PM"],["15","05-03-2026","5:04:05 AM","6:02:37 PM"],["16","06-03-2026","5:02:58 AM","6:03:24 PM"],["17","07-03-2026","5:01:51 AM","6:04:10 PM"],["18","08-03-2026","5:00:43 AM","6:04:57 PM"],["19","09-03-2026","4:59:35 AM","6:05:43 PM"],["20","10-03-2026","4:58:26 AM","6:06:29 PM"],["21","11-03-2026","4:57:17 AM","6:07:15 PM"],["22","12-03-2026","4:56:07 AM","6:08:01 PM"],["23","13-03-2026","4:45:56 AM","6:08:47 PM"],["24","14-03-2026","4:45:45 AM","6:09:33 PM"],["25","15-03-2026","4:45:34 AM","6:10:18 PM"],["26","16-03-2026","4:45:22 AM","6:11:04 PM"],["27","17-03-2026","4:45:10 AM","6:11:50 PM"],["28","18-03-2026","4:45:58 AM","6:12:35 PM"],["29","19-03-2026","4:45:45 AM","6:13:21 PM"],["30","20-03-2026","4:44:29 AM","6:14:06 PM"]
      ],
      'ISLAMABAD': [
        ["1","19-02-2026","5:24:03 AM","5:58:15 PM"],["2","20-02-2026","5:23:02 AM","5:59:08 PM"],["3","21-02-2026","5:22:00 AM","6:00:01 PM"],["4","22-02-2026","5:20:57 AM","6:00:54 PM"],["5","23-02-2026","5:19:53 AM","6:01:46 PM"],["6","24-02-2026","5:18:48 AM","6:02:38 PM"],["7","25-02-2026","5:17:41 AM","6:03:29 PM"],["8","26-02-2026","5:16:33 AM","6:04:20 PM"],["9","27-02-2026","5:15:25 AM","6:05:11 PM"],["10","28-02-2026","5:14:15 AM","6:06:02 PM"],["11","01-03-2026","5:13:05 AM","6:06:53 PM"],["12","02-03-2026","5:11:53 AM","6:07:44 PM"],["13","03-03-2026","5:10:41 AM","6:08:34 PM"],["14","04-03-2026","5:09:27 AM","6:09:25 PM"],["15","05-03-2026","5:08:13 AM","6:10:15 PM"],["16","06-03-2026","5:06:58 AM","6:11:05 PM"],["17","07-03-2026","5:05:42 AM","6:11:55 PM"],["18","08-03-2026","5:04:25 AM","6:12:45 PM"],["19","09-03-2026","5:03:07 AM","6:13:35 PM"],["20","10-03-2026","5:01:48 AM","6:14:24 PM"],["21","11-03-2026","5:00:28 AM","6:15:14 PM"],["22","12-03-2026","4:59:08 AM","6:16:04 PM"],["23","13-03-2026","4:57:46 AM","6:16:53 PM"],["24","14-03-2026","4:56:24 AM","6:17:43 PM"],["25","15-03-2026","4:55:01 AM","6:18:32 PM"],["26","16-03-2026","4:53:38 AM","6:19:21 PM"],["27","17-03-2026","4:52:13 AM","6:20:11 PM"],["28","18-03-2026","4:50:48 AM","6:21:00 PM"],["29","19-03-2026","4:49:22 AM","6:21:49 PM"],["30","20-03-2026","4:47:56 AM","6:22:38 PM"]
      ]
    };

    let currentCity = 'KARACHI';
    let todayData = null;
    let nextData = null;
    let timerInterval = null;

    const months = ["JAN", "FEB", "MAR", "APR", "MAY", "JUN", "JUL", "AUG", "SEP", "OCT", "NOV", "DEC"];
    const days = ["SUNDAY", "MONDAY", "TUESDAY", "WEDNESDAY", "THURSDAY", "FRIDAY", "SATURDAY"];

    // Theme Logic Setup
    const moonIcon = '<path d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9c0-.46-.04-.92-.1-1.36-.98 1.37-2.58 2.26-4.4 2.26-3.03 0-5.5-2.47-5.5-5.5 0-1.82.89-3.42 2.26-4.4-.44-.06-.9-.1-1.36-.1z"/>';
    const sunIcon = '<path d="M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5S14.76,7,12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0 c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2 c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1 C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06 c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41 l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41 c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36 c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"/>';

    function initTheme() {
        const savedTheme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', savedTheme);
        document.getElementById('theme-icon').innerHTML = savedTheme === 'dark' ? sunIcon : moonIcon;
    }

    function toggleTheme() {
        const currentTheme = document.documentElement.getAttribute('data-theme');
        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
        
        document.documentElement.setAttribute('data-theme', newTheme);
        localStorage.setItem('theme', newTheme);
        document.getElementById('theme-icon').innerHTML = newTheme === 'dark' ? sunIcon : moonIcon;
    }

    function parseAppDate(dateStr) {
        const parts = dateStr.split('-');
        return new Date(parts[2], parts[1] - 1, parts[0]);
    }

    function parseTimeObj(dateStr, timeStr) {
        const d = parseAppDate(dateStr);
        const parts = timeStr.match(/(\d+):(\d+):(\d+)\s*(AM|PM)/i);
        if (!parts) return d;
        let h = parseInt(parts[1], 10), m = parseInt(parts[2], 10), s = parseInt(parts[3], 10);
        if (parts[4].toUpperCase() === "PM" && h < 12) h += 12;
        if (parts[4].toUpperCase() === "AM" && h === 12) h = 0;
        d.setHours(h, m, s, 0);
        return d;
    }

    function init() {
        initTheme();
        updateDashboard();
        renderCalendar();
        if(timerInterval) clearInterval(timerInterval);
        timerInterval = setInterval(updateCountdown, 1000);
        updateCountdown();
    }

    function updateDashboard() {
        const now = new Date();
        const rows = DB[currentCity];
        
        let targetIndex = 0;
        for (let i = 0; i < rows.length; i++) {
            const rowDate = parseAppDate(rows[i][1]);
            if (now.getDate() === rowDate.getDate() && now.getMonth() === rowDate.getMonth()) {
                targetIndex = i; break;
            } else if (now < rowDate) {
                targetIndex = i; break;
            }
        }

        todayData = rows[targetIndex];
        nextData = (targetIndex + 1 < rows.length) ? rows[targetIndex + 1] : null;

        const dateObj = parseAppDate(todayData[1]);
        
        document.getElementById('selected-city').innerText = currentCity;
        document.getElementById('date-display').innerText = `${String(dateObj.getDate()).padStart(2, '0')} ${months[dateObj.getMonth()]} / ${String(todayData[0]).padStart(2, '0')} RAMADAN`;
        document.getElementById('day-display').innerText = days[dateObj.getDay()];
        
        document.getElementById('sahar-time').innerText = todayData[2];
        document.getElementById('iftar-time').innerText = todayData[3];
    }

    function updateCountdown() {
        if (!todayData) return;
        
        const now = new Date();
        let targetTime, label;

        const saharTime = parseTimeObj(todayData[1], todayData[2]);
        const iftarTime = parseTimeObj(todayData[1], todayData[3]);

        if (now < saharTime) {
            targetTime = saharTime;
            label = "Time until Sahar";
        } else if (now < iftarTime) {
            targetTime = iftarTime;
            label = "Time until Iftar";
        } else {
            if (nextData) {
                targetTime = parseTimeObj(nextData[1], nextData[2]);
                label = "Time until Sahar";
            } else {
                document.getElementById('countdown-label').innerText = "Ramadan Mubarak!";
                document.getElementById('countdown-timer').innerText = "00:00:00";
                return;
            }
        }

        const diff = targetTime - now;
        if (diff <= 0) {
            init(); 
            return;
        }

        const h = Math.floor(diff / (1000 * 60 * 60));
        const m = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        const s = Math.floor((diff % (1000 * 60)) / 1000);

        document.getElementById('countdown-label').innerText = label;
        document.getElementById('countdown-timer').innerText = 
            `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`;
    }

    function renderCalendar() {
        const tbody = document.getElementById('calendar-body');
        tbody.innerHTML = '';
        const rows = DB[currentCity];
        const now = new Date();
        
        rows.forEach(row => {
            const tr = document.createElement('tr');
            const rowDate = parseAppDate(row[1]);
            const isToday = now.getDate() === rowDate.getDate() && now.getMonth() === rowDate.getMonth();
            if (isToday) tr.className = 'active-day';
            
            tr.innerHTML = `
                <td>${row[0]}</td>
                <td>${row[1]}</td>
                <td>${row[2]}</td>
                <td>${row[3]}</td>
            `;
            tbody.appendChild(tr);
        });
        document.getElementById('cal-title').innerText = `${currentCity} Calendar`;
    }

    function changeCity(city) {
        currentCity = city;
        closeModals();
        init();
    }

    function openCityModal() { document.getElementById('city-modal').style.display = 'flex'; }
    function openCalendarModal() { document.getElementById('calendar-modal').style.display = 'flex'; }
    function closeModals() { 
        document.getElementById('city-modal').style.display = 'none'; 
        document.getElementById('calendar-modal').style.display = 'none'; 
    }

    window.onload = init;
</script>

</body>
</html>